<% layout('layout') %>

<div>
  <div class="d-flex pt-3">
    <div class="btn btn-primary position-relative">
      Messages
      <span
        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
      >
        <%= messages.length <= 99 ? messages.length : '+99' %>
        <span class="visually-hidden">Messages</span>
      </span>
    </div>
    <a class="ms-auto" href="/create-message">Create message</a>
  </div>

  <% if (error) { %>
  <div class="alert alert-danger"><%= error %></div>
  <% } %>

  <div>
    <% if (messages.length > 0) { %>
    <ul class="list-group list-group-flush">
      <% messages.forEach((message) => { %>
      <li class="list-group-item">
        <div class="bg-light p-3 rounded my-3">
          <span class="fs-5"><%- message.title %></span>
          <p class="my-1"><%- message.text %></p>
          <% if (user.membership_status === 'member') { %>
          <div class="d-flex justify-content-between">
            <small
              >By <a href="/">@<%- message.username %></a> - <%=
              formatDistanceToNow(new Date(message.created_at), { addSuffix:
              true }) %></small
            >
            <% if (user.is_admin) { %>
            <a href="/messages/<%= message.id %>/delete" class="text-danger"
              >Delete</a
            >
            <% } %>
          </div>
          <% } %>
        </div>
      </li>
      <% }); %>
    </ul>
    <% } else { %>
    <div class="alert alert-info">
      No messages yet. Be the first to
      <a href="/create-message">create a message</a>.
    </div>
    <% } %>
  </div>
</div>
